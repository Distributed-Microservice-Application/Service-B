# ===========================================
# SERVER CONFIGURATION
# ===========================================
server.port=8082
spring.application.name=service-b

# ===========================================
# DATABASE CONFIGURATION (LEADER)
# ===========================================
spring.datasource.leader.url=${SPRING_DATASOURCE_LEADER_URL:jdbc:postgresql://localhost:5432/outbox_write}
spring.datasource.leader.username=${SPRING_DATASOURCE_LEADER_USERNAME:postgres}
spring.datasource.leader.password=${SPRING_DATASOURCE_LEADER_PASSWORD:gerges1020}
spring.datasource.leader.driver-class-name=${SPRING_DATASOURCE_LEADER_DRIVER_CLASS_NAME:org.postgresql.Driver}
spring.datasource.leader.hikari.maximum-pool-size=20
spring.datasource.leader.hikari.minimum-idle=5
spring.datasource.leader.hikari.connection-timeout=30000
spring.datasource.leader.hikari.idle-timeout=600000
spring.datasource.leader.hikari.max-lifetime=1800000

# ===========================================
# DATABASE CONFIGURATION (REPLICA)
# ===========================================
spring.datasource.replica.url=${SPRING_DATASOURCE_REPLICA_URL:jdbc:postgresql://localhost:5432/outbox_read}
spring.datasource.replica.username=${SPRING_DATASOURCE_REPLICA_USERNAME:postgres}
spring.datasource.replica.password=${SPRING_DATASOURCE_REPLICA_PASSWORD:gerges1020}
spring.datasource.replica.driver-class-name=${SPRING_DATASOURCE_REPLICA_DRIVER_CLASS_NAME:org.postgresql.Driver}
spring.datasource.replica.hikari.maximum-pool-size=10
spring.datasource.replica.hikari.minimum-idle=3
spring.datasource.replica.hikari.connection-timeout=30000
spring.datasource.replica.hikari.idle-timeout=600000
spring.datasource.replica.hikari.max-lifetime=1800000

# ===========================================
# JPA/HIBERNATE CONFIGURATION
# ===========================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ===========================================
# KAFKA CONFIGURATION
# ===========================================
spring.kafka.consumer.bootstrap-servers=${SPRING_KAFKA_CONSUMER_BOOTSTRAP_SERVERS:localhost:29092}
spring.kafka.consumer.group-id=service-b-consumer-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.enable-auto-commit=true
spring.kafka.consumer.auto-commit-interval=1000
spring.kafka.consumer.session-timeout=30000
spring.kafka.consumer.heartbeat-interval=3000
spring.kafka.consumer.max-poll-records=500
spring.kafka.consumer.max-poll-interval=300000

# ===========================================
# ACTUATOR CONFIGURATION
# ===========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
management.server.port=9092

# ===========================================
# LOGGING CONFIGURATION
# ===========================================
logging.level.com.DMA.Service_B=INFO
logging.level.org.springframework.kafka=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ===========================================
# SPRING BOOT CONFIGURATION
# ===========================================
spring.main.allow-bean-definition-overriding=true
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC

# ===========================================
# PERFORMANCE TUNING
# ===========================================
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.connection-timeout=20000
server.tomcat.max-connections=8192
server.tomcat.accept-count=100

# ===========================================
# APPLICATION SPECIFIC PROPERTIES
# ===========================================
app.kafka.topic.summation-events=summation-events
kafka.topic.summation=user-events
app.metrics.enabled=true
app.database.connection-pool.max-size=20
app.database.connection-pool.min-size=5